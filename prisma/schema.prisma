// Vorlage für die SQL-Datenbank wird erstellt
// Prisma-Konfiguration: aus diesem Schema generiert Prisma den TypeScript-Client (Bibliothek mit wichtigen Befehlen für Datenbanken)
generator client {
  provider = "prisma-client-js"
}

// Datenquelle: PostgreSQL; URLs kommen aus Umgebungsvariablen (.env)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL") // nutzt den direkten 5432-Endpoint (oder notfalls denselben Pooler)
}

// Neuer Typ
enum HottakeStatus {
  OFFEN
  WAHR
  FALSCH
}

// Neuer Typ
enum GameDayStatus {
  PENDING
  ACTIVE
  FINALIZED
  ARCHIVED
}

//@ gibt Prisma zusätzliche Informationen zu Feldern in der Datenbank (Attribute)
model Hottake {
  id        Int            @id @default(autoincrement()) // Wert wird automatisch hochgezählt
  text      String
  status    HottakeStatus  @default(OFFEN) 
  gameDay   Int            @default(0)
  gameDayRef GameDay?      @relation("GameDayHottakes", fields: [gameDay], references: [gameDay])
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  @@map("hottakes") //@@"..." gibt Tabellennamen an
}

model User {
  id           Int          @id @default(autoincrement())
  nickname     String       @unique
  email        String      @unique 
  passwordHash String      
  resetToken   String?      @unique
  resetTokenExpiry DateTime?
  prefs        Json?        @default("{}") 
  createdAt    DateTime     @default(now())
  submissions  Submission[]

  @@map("users")
}

model Submission {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  gameDay   Int
  gameDayRef GameDay? @relation("GameDaySubmissions", fields: [gameDay], references: [gameDay])
  picks     Int[]    // [] heißt, dass es sich um eine Liste von diesem Datentyp handelt
  score     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([userId, gameDay]) // Es darf nur eine Submission für jeden User pro Spieltag geben (Nicht mehrere Picks)
  @@map("submissions")
}

model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("settings")
}

model GameDay {
  id          Int           @id @default(autoincrement())
  gameDay     Int           @unique
  description String
  startTime   DateTime?
  lockTime    DateTime?
  finalizedAt DateTime?
  status      GameDayStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  hottakes    Hottake[]     @relation("GameDayHottakes")
  submissions Submission[]  @relation("GameDaySubmissions")
  @@map("gamedays")
}
