// Prisma-Konfiguration: aus diesem Schema generiert Prisma den TypeScript-Client
generator client {
  provider = "prisma-client-js"
}

// Datenquelle: PostgreSQL – URLs kommen aus Umgebungsvariablen
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL") // nutzt den direkten 5432-Endpoint (oder notfalls denselben Pooler)
}

// Enum für den Status eines Hottakes (OFFEN/WAHR/FALSCH)
enum HottakeStatus {
  OFFEN
  WAHR
  FALSCH
}

// Status eines Spieltags
enum GameDayStatus {
  PENDING
  ACTIVE
  FINALIZED
  ARCHIVED
}

// Kernmodell: ein einzelner Hottake mit Text und Status
model Hottake {
  id        Int            @id @default(autoincrement())
  text      String
  status    HottakeStatus  @default(OFFEN)
  gameDay   Int            @default(0)
  gameDayRef GameDay?      @relation("GameDayHottakes", fields: [gameDay], references: [gameDay])
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  @@map("hottakes")
}

// User mit eindeutigem Nickname (1:n zu Submissions ist hier als 1:1 modelliert)
model User {
  id           Int          @id @default(autoincrement())
  nickname     String       @unique
  email        String?      @unique // Optional vorerst, falls Alt-Daten existieren ohne Email
  passwordHash String?      // Optional für Übergang, aber Pflicht für neue Auth
  resetToken   String?      @unique
  resetTokenExpiry DateTime?
  prefs        Json?        @default("{}") // Für Dark Mode etc. (Phase 9)
  createdAt    DateTime     @default(now())
  submissions  Submission[]

  @@map("users")
}

// Eine Abgabe (Submission) pro User: enthält die Picks als Integer-Array
model Submission {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  gameDay   Int
  gameDayRef GameDay? @relation("GameDaySubmissions", fields: [gameDay], references: [gameDay])
  picks     Int[]
  score     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([userId, gameDay])
  @@map("submissions")
}

// Schlüssel-Wert-Einstellungen, z. B. für Konfigurationen zur Laufzeit
model Setting {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("settings")
}

// Spieltage mit explizitem Status
model GameDay {
  id          Int           @id @default(autoincrement())
  gameDay     Int           @unique
  description String
  startTime   DateTime?
  lockTime    DateTime?
  finalizedAt DateTime?
  status      GameDayStatus @default(ACTIVE)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  hottakes    Hottake[]     @relation("GameDayHottakes")
  submissions Submission[]  @relation("GameDaySubmissions")
  @@map("gamedays")
}
